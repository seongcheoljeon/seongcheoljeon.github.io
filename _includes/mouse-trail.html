<!-- Mouse Trail Effect -->
<canvas id="trail-canvas" aria-hidden="true"></canvas>

<style>
  #trail-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 99998; /* 커서(99999) 바로 아래 */
    pointer-events: none;
  }
</style>

<script>
  (function () {
    const canvas = document.getElementById("trail-canvas");
    const ctx = canvas.getContext("2d");

    const CONFIG = {
      maxParticles: 60 /* 최대 파티클 수 */,
      spawnRate: 2 /* 마우스 이동 시 프레임당 생성 수 */,
      lifespan: 40 /* 프레임 단위 수명 */,
      minRadius: 1.0,
      maxRadius: 2.5
    };

    let particles = [];
    let mouseX = -999,
      mouseY = -999;
    let isMoving = false;
    let moveTimer;

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function createParticle(x, y) {
      const angle = Math.random() * Math.PI * 2;
      const speed = Math.random() * 0.6;
      return {
        x,
        y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed - 0.3 /* 살짝 위로 */,
        radius:
          CONFIG.minRadius +
          Math.random() * (CONFIG.maxRadius - CONFIG.minRadius),
        life: CONFIG.lifespan,
        maxLife: CONFIG.lifespan
      };
    }

    function update() {
      /* 이동 중에만 파티클 생성 */
      if (isMoving) {
        for (let i = 0; i < CONFIG.spawnRate; i++) {
          if (particles.length < CONFIG.maxParticles) {
            particles.push(createParticle(mouseX, mouseY));
          }
        }
      }

      /* 파티클 업데이트 */
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.life--;
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.02; /* 중력 */
        p.radius *= 0.97;

        if (p.life <= 0 || p.radius < 0.2) {
          particles.splice(i, 1);
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < particles.length; i++) {
        const p = particles[i];
        const ratio = p.life / p.maxLife;

        /* 글로우 효과 */
        const grad = ctx.createRadialGradient(
          p.x,
          p.y,
          0,
          p.x,
          p.y,
          p.radius * 2.5
        );
        grad.addColorStop(0, "rgba(138, 180, 248, " + ratio * 0.9 + ")");
        grad.addColorStop(0.5, "rgba(100, 160, 255, " + ratio * 0.4 + ")");
        grad.addColorStop(1.0, "rgba(100, 140, 255, 0)");

        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius * 2.5, 0, Math.PI * 2);
        ctx.fillStyle = grad;
        ctx.fill();

        /* 코어 */
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(200, 220, 255, " + ratio * 0.95 + ")";
        ctx.fill();
      }
    }

    function animate() {
      update();
      draw();
      requestAnimationFrame(animate);
    }

    window.addEventListener("mousemove", function (e) {
      mouseX = e.clientX;
      mouseY = e.clientY;
      isMoving = true;
      clearTimeout(moveTimer);
      moveTimer = setTimeout(function () {
        isMoving = false;
      }, 80);
    });

    window.addEventListener("resize", resize);
    resize();
    animate();
  })();
</script>
