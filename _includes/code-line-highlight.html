<!-- Code Block Line Highlight -->
<style>
  .highlight .rouge-code pre {
    position: relative;
  }

  .code-line-overlay {
    position: absolute;
    left: -1rem;   /* td.rouge-code padding-left 보정 */
    right: -2rem;  /* td.rouge-code padding-right 보정 */
    height: 1.4rem;
    pointer-events: none;
    background: rgba(138, 180, 248, 0.08);
    border-left: 2px solid rgba(138, 180, 248, 0.6);
    opacity: 0;
    z-index: 0;
  }

  [data-mode='light'] .code-line-overlay {
    background: rgba(30, 100, 220, 0.07);
    border-left-color: rgba(30, 100, 220, 0.5);
  }
</style>

<script>
  (function () {
    function remToPx(pre) {
      /* 실제 code 엘리먼트의 lineHeight를 읽어서 사용 */
      var code = pre.querySelector('code');
      var el   = code || pre;
      var lh   = parseFloat(getComputedStyle(el).lineHeight);
      return isNaN(lh) ? 22 : lh;
    }

    function init() {
      document.querySelectorAll('.highlight .rouge-code pre').forEach(function (pre) {
        if (pre.dataset.lineHlBound) return;
        pre.dataset.lineHlBound = '1';

        var overlay = document.createElement('div');
        overlay.className = 'code-line-overlay';
        pre.appendChild(overlay);

        pre.addEventListener('mousemove', function (e) {
          var lineH   = remToPx(pre);
          var rect    = pre.getBoundingClientRect();
          var offsetY = e.clientY - rect.top + pre.scrollTop;
          var lineIdx = Math.max(0, Math.floor(offsetY / lineH));
          overlay.style.top     = (lineIdx * lineH) + 'px';
          overlay.style.opacity = '1';
        });

        pre.addEventListener('mouseleave', function () {
          overlay.style.opacity = '0';
        });
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>
